# 📖 스토리 모드 구성안 (Campaign Story System)

## 🎯 현재 상태 분석

### ✅ 구현된 것
- **캠페인 스테이지 시스템**: 10개의 스테이지 (입문 ~ 최종 보스)
- **스테이지 정보**: 이름, 테마, 권장 파워, 보상 시스템
- **진행도 저장**: `cleared` 플래그로 클리어 여부 추적
- **화면 전환**: 캠페인 선택 → 전투 → 보상 흐름

### ❌ 부족한 것
- **스토리 텍스트**: 스테이지별 배경 이야기 없음
- **캐릭터 대화**: NPC, 적 캐릭터와의 상호작용 없음
- **컷신/연출**: 스테이지 전후 스토리 연출 없음
- **선택지 시스템**: 플레이어 선택에 따른 스토리 분기 없음
- **캐릭터 성장**: 스토리 진행에 따른 캐릭터 관계 발전 없음

---

## 🏗️ 스토리 모드 구조 제안

### 1️⃣ 데이터 구조 확장

#### **A. `CampaignStage` 타입 확장**

```typescript
type CampaignStage = {
  // 기존 필드
  id: number;
  name: string;
  theme: string;
  recommendedPower: number;
  firstReward: { gold: number; shards: number; cards?: string[] };
  repeatReward: { gold: number; shards: number };
  cleared: boolean;
  
  // 🆕 스토리 필드 추가
  story: {
    // 스테이지 선택 시 표시되는 배경 설명
    description: string; // "불의 시련: 화염 속성 적들이 가득한 화산 지대"
    
    // 전투 전 컷신 (Pre-Battle Cutscene)
    preBattle?: {
      background?: string; // 배경 이미지 경로
      character?: string; // 등장 캐릭터 ID
      characterName?: string; // 캐릭터 이름 (i18n 키)
      characterImage?: string; // 캐릭터 이미지 경로
      dialogues: Array<{
        speaker: 'player' | 'enemy' | 'narrator'; // 화자
        text: string; // 대사 (i18n 키)
        emotion?: 'normal' | 'angry' | 'happy' | 'sad' | 'surprised'; // 표정
      }>;
    };
    
    // 전투 후 컷신 (Post-Battle Cutscene)
    postBattle?: {
      victory: {
        dialogues: Array<{
          speaker: 'player' | 'enemy' | 'narrator';
          text: string;
          emotion?: string;
        }>;
      };
      defeat?: {
        dialogues: Array<{
          speaker: 'player' | 'enemy' | 'narrator';
          text: string;
          emotion?: string;
        }>;
      };
    };
    
    // 선택지 시스템 (Optional)
    choices?: Array<{
      id: string;
      text: string; // i18n 키
      effect?: {
        gold?: number;
        shards?: number;
        cards?: string[];
        unlockStage?: number;
      };
    }>;
  };
};
```

#### **B. 새로운 스토리 상태 추가**

```typescript
type BattleState = {
  // ... 기존 필드 ...
  
  // 🆕 스토리 모드 상태
  storyProgress: {
    currentChapter: number; // 현재 챕터 (1~3)
    unlockedStages: number[]; // 해금된 스테이지 ID 목록
    completedDialogues: string[]; // 본 대화 ID 목록 (스킵 방지)
    playerChoices: Record<string, string>; // 스테이지별 선택 기록
  };
  
  // 스토리 관련 함수
  showCutscene: (cutscene: CutsceneData) => void;
  makeChoice: (stageId: number, choiceId: string) => void;
  unlockStage: (stageId: number) => void;
};
```

---

### 2️⃣ 스토리 컨텐츠 구성 (3챕터 구조)

#### **📕 Chapter 1: 입문과 수련 (Stage 1-3)**

**테마**: 세라피나(플레이어)가 벨몬트 가문의 전통 카드 배틀을 배우는 초반 여정

| Stage | 이름 | 적 캐릭터 | 스토리 요약 |
|-------|------|----------|------------|
| 1 | 입문 | Lucian (하인) | 세라피나가 카드 배틀을 처음 배우는 튜토리얼. 루시안이 친절하게 가르쳐준다. |
| 2 | 불의 시련 | Ariana Drake | 아리아나가 질투심으로 세라피나에게 도전. 화염 카드로 공격. |
| 3 | 얼음 요새 | Seraphine Winters | 얼음 속성 마법사와의 대결. 전략적 플레이 필요. |

**스토리 흐름**:
```
[Stage 1 - 전투 전]
세라피나: "이게... 벨몬트 가문의 전통 카드 배틀이라는 거죠?"
Lucian: "그렇습니다, 아가씨. 천천히 배우시면 됩니다."

[Stage 1 - 전투 후 승리]
세라피나: "생각보다 재미있네요!"
Lucian: "천부적인 재능이 있으십니다. 계속 수련하시면..."

[Stage 2 - 전투 전]
Ariana: "넌... 카이 님의 약혼자라는 그 시골 소녀구나? 후훗."
세라피나: "...?"
Ariana: "내 화염 카드의 힘을 똑똑히 봐!"

[Stage 2 - 전투 후 승리]
Ariana: "이, 이럴 수가... 나의 프라이드가..."
세라피나: "괜찮으세요? 치료가 필요하시면..."
Ariana: (속으로) "뭐지... 이 따뜻한 느낌은..."
```

---

#### **📘 Chapter 2: 성장과 갈등 (Stage 4-7)**

**테마**: 실력이 늘어나는 세라피나와 라이벌들과의 격돌

| Stage | 이름 | 적 캐릭터 | 스토리 요약 |
|-------|------|----------|------------|
| 4 | 뇌전의 탑 | Leon Ardenia | 왕국 기사단의 전기 마법사. 강한 적수. |
| 5 | 바람의 신전 | Iris Belmont | 벨몬트 가문의 여동생이 실력을 테스트. |
| 6 | 화염과 빙설 | Ariana + Seraphine | 두 라이벌이 연합해서 도전 (2vs1 보스전). |
| 7 | 폭풍의 전장 | Garen Stone | 석화 마법과 바람 마법의 조합. 강력한 적수. |

**스토리 흐름**:
```
[Stage 4 - 전투 전]
Leon: "벨몬트 가문의 새 아가씨라고? 흥미롭군. 나의 뇌전 마법을 막아보시지."
세라피나: "최선을 다하겠습니다!"

[Stage 6 - 전투 전] (특별 이벤트: 2vs1)
Ariana: "세라피나... 너의 실력을 인정하지 않을 수 없어."
Seraphine: "함께 그녀를 시험해보는 건 어때?"
세라피나: "둘이서... 함께 오시는 건가요?!"
Narrator: "라이벌들의 연합! 세라피나는 이 시련을 극복할 수 있을까?"

[Stage 6 - 전투 후 승리]
Ariana: "...대단해. 인정할 수밖에 없네."
Seraphine: "후후, 역시 벨몬트 가문의 새 아가씨다워."
세라피나: "감사합니다... 두 분 덕분에 더 강해진 것 같아요."
```

---

#### **📙 Chapter 3: 최종 시련 (Stage 8-10)**

**테마**: 최강의 적들과의 대결, 진정한 실력 증명

| Stage | 이름 | 적 캐릭터 | 스토리 요약 |
|-------|------|----------|------------|
| 8 | 정예 부대 | Marcus Belmont | 벨몬트 가문의 장남이자 엘리트 마법사. |
| 9 | 보스 전초전 | Darius Blackwood | 어둠 속성 마법사. 최종 보스 전 마지막 시험. |
| 10 | 최종 보스 | Elder Belmont | 벨몬트 가문의 가주. 모든 속성을 자유자재로. |

**스토리 흐름**:
```
[Stage 10 - 전투 전]
Elder Belmont: "세라피나. 여기까지 왔구나."
세라피나: "예, 가주님."
Elder Belmont: "좋아. 이제 내가 직접 네 실력을 확인하겠다. 각오하거라."
Kai (옆에서): "세라피나... 힘내."
세라피나: "네, 카이 님!"

[Stage 10 - 전투 후 승리]
Elder Belmont: "훌륭하다. 넌 진정 벨몬트 가문의 일원이 될 자격이 있어."
세라피나: "감사합니다, 가주님!"
Kai: "세라피나! 정말 대단해!"
Ariana: (멀리서 지켜보며) "...축하해, 세라피나."
Narrator: "세라피나는 모든 시련을 극복하고, 벨몬트 가문에 받아들여졌다."
[END OF CAMPAIGN - TO BE CONTINUED...]
```

---

### 3️⃣ UI/UX 구현 계획

#### **A. 컷신 화면 (Cutscene Screen)**

```
┌─────────────────────────────────────────────┐
│ [배경 이미지: 화산 지대]                      │
│                                              │
│    [캐릭터 이미지]                            │
│    Ariana Drake                              │
│    (화난 표정)                                │
│                                              │
│  ┌─────────────────────────────────────┐    │
│  │ "넌... 카이 님의 약혼자라는 그 시골  │    │
│  │  소녀구나? 후훗. 내 화염 카드의      │    │
│  │  힘을 똑똑히 봐!"                    │    │
│  └─────────────────────────────────────┘    │
│                                              │
│     [Skip ▶]  [Next →]                      │
└─────────────────────────────────────────────┘
```

**구현 포인트**:
- 배경 이미지: CSS `background-image` 또는 PixiJS Sprite
- 캐릭터 이미지: 감정별 이미지 (normal, angry, happy, sad, surprised)
- 대화창: HTML `<div>` 또는 PixiJS Text + Graphics
- 타이핑 효과: 한 글자씩 나타나는 애니메이션 (선택사항)
- Auto-play: 3초 후 자동 진행 (Skip 버튼으로 건너뛰기 가능)

---

#### **B. 스테이지 선택 화면 개선**

```
┌─────────────────────────────────────────────┐
│  📖 Chapter 1: 입문과 수련                   │
│                                              │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐       │
│  │ Stage 1 │ │ Stage 2 │ │ Stage 3 │       │
│  │  입문   │ │불의 시련│ │얼음 요새│       │
│  │   ✓     │ │   ✓     │ │  🔒    │       │
│  │  Lv.1   │ │  Lv.2   │ │  Lv.3   │       │
│  └─────────┘ └─────────┘ └─────────┘       │
│                                              │
│  📖 Chapter 2: 성장과 갈등 (🔒 잠김)         │
│  ...                                         │
└─────────────────────────────────────────────┘
```

**개선 사항**:
- **챕터 구분**: 3개 챕터로 시각적 그룹핑
- **잠금 시스템**: 이전 스테이지 클리어 전까지 🔒 표시
- **미리보기**: 호버 시 스테이지 설명 툴팁 표시
- **진행도 표시**: 클리어한 스테이지는 ✓ 아이콘

---

#### **C. 선택지 시스템 (Optional)**

일부 스테이지에서 전투 후 선택지 제공:

```
┌─────────────────────────────────────────────┐
│  [전투 승리!]                                │
│                                              │
│  Ariana: "나... 졌어. 어쩔 건데?"            │
│                                              │
│  선택지:                                     │
│  ┌─────────────────────────────────────┐    │
│  │ 1. "괜찮아요? 치료해드릴게요."       │    │
│  │    → +2 친밀도, +50 골드             │    │
│  └─────────────────────────────────────┘    │
│  ┌─────────────────────────────────────┐    │
│  │ 2. "당신의 카드, 훌륭했어요."        │    │
│  │    → +1 친밀도, 카드 1장 획득        │    │
│  └─────────────────────────────────────┘    │
│  ┌─────────────────────────────────────┐    │
│  │ 3. "다음엔 더 강해지세요."           │    │
│  │    → 보상 없음                       │    │
│  └─────────────────────────────────────┘    │
└─────────────────────────────────────────────┘
```

---

### 4️⃣ 데이터 관리 구조

#### **A. 스토리 데이터 파일 분리**

```
web/
├── src/
│   ├── data/
│   │   ├── cards.json              # 카드 데이터
│   │   ├── campaignStages.json     # 🆕 캠페인 스테이지 + 스토리
│   │   ├── characters.json         # 🆕 캐릭터 정보 (이름, 이미지 경로)
│   │   └── dialogues/              # 🆕 대사 i18n
│   │       ├── ko.json              # 한국어 대사
│   │       └── en.json              # 영어 대사
```

#### **B. `campaignStages.json` 예시**

```json
[
  {
    "id": 1,
    "name": "stage_1_name",
    "theme": "Neutral",
    "recommendedPower": 100,
    "firstReward": { "gold": 200, "shards": 2 },
    "repeatReward": { "gold": 100, "shards": 1 },
    "story": {
      "description": "stage_1_description",
      "preBattle": {
        "character": "lucian",
        "dialogues": [
          {
            "speaker": "enemy",
            "text": "stage_1_pre_lucian_1",
            "emotion": "normal"
          },
          {
            "speaker": "player",
            "text": "stage_1_pre_player_1",
            "emotion": "normal"
          }
        ]
      },
      "postBattle": {
        "victory": {
          "dialogues": [
            {
              "speaker": "player",
              "text": "stage_1_post_victory_1",
              "emotion": "happy"
            }
          ]
        }
      }
    }
  }
]
```

#### **C. `dialogues/ko.json` 예시**

```json
{
  "stage_1_name": "입문",
  "stage_1_description": "벨몬트 가문의 전통 카드 배틀을 배우는 첫 시련",
  "stage_1_pre_lucian_1": "그렇습니다, 아가씨. 천천히 배우시면 됩니다.",
  "stage_1_pre_player_1": "이게... 벨몬트 가문의 전통 카드 배틀이라는 거죠?",
  "stage_1_post_victory_1": "생각보다 재미있네요!",
  
  "stage_2_name": "불의 시련",
  "stage_2_description": "화염 속성 적들이 가득한 화산 지대",
  "stage_2_pre_ariana_1": "넌... 카이 님의 약혼자라는 그 시골 소녀구나? 후훗.",
  "stage_2_pre_ariana_2": "내 화염 카드의 힘을 똑똑히 봐!"
}
```

---

### 5️⃣ 구현 우선순위

#### **Phase 1: 기본 스토리 시스템 (1-2일)**
- [ ] `CampaignStage` 타입에 `story` 필드 추가
- [ ] `campaignStages.json` 생성 및 10개 스테이지 기본 스토리 작성 (간단한 설명문구만)
- [ ] 스테이지 선택 화면에 `description` 표시

#### **Phase 2: 컷신 시스템 (2-3일)**
- [ ] 컷신 화면 UI 구현 (HTML + CSS)
- [ ] `preBattle` 대화 표시 로직
- [ ] `postBattle` 대화 표시 로직
- [ ] Skip/Next 버튼 구현
- [ ] 타이핑 효과 애니메이션 (선택사항)

#### **Phase 3: 캐릭터 시스템 (1-2일)**
- [ ] `characters.json` 생성 (캐릭터 ID, 이름, 이미지 경로)
- [ ] 캐릭터 이미지 에셋 준비 (기본 5종: normal, angry, happy, sad, surprised)
- [ ] 감정별 이미지 전환 로직

#### **Phase 4: i18n 통합 (1일)**
- [ ] `dialogues/ko.json`, `dialogues/en.json` 생성
- [ ] 모든 대사 i18n 키로 변환
- [ ] 언어 전환 시 대사 자동 번역

#### **Phase 5: 챕터 시스템 (1일)**
- [ ] 챕터별 그룹핑 UI
- [ ] 잠금/해금 시스템
- [ ] 진행도 저장 (localStorage)

#### **Phase 6: 선택지 시스템 (선택사항, 2-3일)**
- [ ] 선택지 UI 구현
- [ ] 선택에 따른 보상 분기
- [ ] 선택 기록 저장

---

### 6️⃣ 리소스 요구사항

#### **A. 이미지 에셋**
- **캐릭터 초상화**: 보상 카드 일러스트 활용 (별도 제작 불필요)
  - 각 캐릭터의 카드 이미지를 그대로 사용
  - 감정 표현: 애니메이션 효과로 처리 (angry: 쉐이크, happy: 바운스, sad: 페이드 등)
  - 기존 카드 이미지 활용으로 리소스 절약 ✅
- **배경 이미지**: **39장** (13종 × 3 variations) ⭐ Variation 시스템
  - 사이즈: **1024x768px** (4:3 비율) ⭐ SD 생성 가능
  - CSS `background-size: cover`로 확대 표시 (배경이라 품질 저하 무시 가능)
  - 포맷: PNG → WebP 변환 권장
  - 상세 프롬프트: `배경_이미지_SD_프롬프트.md` 참조
  - **스테이지별 고유 배경**: 각 스테이지마다 테마에 맞는 독특한 분위기
  - **3개 Variation**: 씬 전환, 재도전, 난이도별 차별화 가능
    - 예: `stage_01_training_1.png`, `stage_01_training_2.png`, `stage_01_training_3.png`

#### **B. 대사 스크립트**
- **총 대사 수**: 약 200~300줄 (스테이지 10개 × 평균 20~30줄)
- **언어**: 한국어 (ko), 영어 (en)
- **포맷**: i18n JSON 파일

#### **C. 감정 표현 애니메이션 (CSS + VFX)**
| 감정 | 애니메이션 효과 | 지속시간 |
|------|----------------|----------|
| **normal** | 부드러운 페이드인 | 0.3초 |
| **angry** | 쉐이크 + 붉은 섬광 VFX | 0.5초 |
| **happy** | 위로 바운스 + 반짝이는 파티클 | 0.6초 |
| **sad** | 느린 페이드 + 파란 오버레이 | 0.8초 |
| **surprised** | 급격한 줌인(1.2배) + 흰색 섬광 | 0.4초 |

#### **D. 사운드 에셋 (선택사항)**
- **캐릭터 보이스**: 각 캐릭터당 5~10개 짧은 음성 클립
- **컷신 BGM**: 스테이지별 분위기에 맞는 배경음악
- **감정 효과음**: angry(폭발음), happy(종소리), surprised(징소리) 등

---

### 7️⃣ 예상 개발 기간

| Phase | 작업 내용 | 예상 기간 |
|-------|----------|----------|
| Phase 1 | 기본 스토리 시스템 | 1-2일 |
| Phase 2 | 컷신 시스템 | 2-3일 |
| Phase 3 | 캐릭터 시스템 | 1-2일 |
| Phase 4 | i18n 통합 | 1일 |
| Phase 5 | 챕터 시스템 | 1일 |
| Phase 6 | 선택지 시스템 (선택) | 2-3일 |
| **총계** | **최소 6-9일, 최대 8-12일** | |

---

### 8️⃣ 대안 제안: 경량 스토리 모드

만약 **빠른 프로토타입**이 필요하다면, 다음과 같은 경량 버전도 가능합니다:

#### **경량 버전 (2-3일 구현)**
- ❌ 캐릭터 이미지 없음
- ❌ 컷신 UI 없음
- ✅ 스테이지 설명 텍스트만 (툴팁 또는 간단한 모달)
- ✅ 전투 전/후 간단한 대사 로그에 표시 (1-2줄)
- ✅ 챕터 구분 없이 선형 진행

**예시**:
```
[스테이지 선택]
"Stage 2: 불의 시련"
"화염 속성 적들이 가득한 화산 지대. 아리아나가 질투심으로 도전해온다."
[전투 시작]

[전투 로그]
Ariana: "내 화염 카드의 힘을 똑똑히 봐!"
[전투 진행]

[전투 승리]
Ariana: "...대단해. 인정할 수밖에 없네."
[보상 획득]
```

---

## 🎯 결론 및 추천 사항

### ✅ 추천 방향
1. **Phase 1 (기본 스토리 시스템)**: 즉시 시작 가능
   - 리소스 부담 없음
   - 빠른 구현 (1-2일)
   - MVP 스토리 경험 제공

2. **Phase 2 (컷신 시스템)**: 리소스 준비되면 진행
   - 캐릭터 이미지 필요
   - 시각적 몰입감 대폭 향상
   - 개발 기간 2-3일

3. **Phase 3-5**: 점진적으로 추가
   - 사용자 피드백 반영하며 개선

4. **Phase 6 (선택지)**: 선택사항
   - 스토리 깊이 추가
   - 리플레이 가치 증가
   - 개발 여유 있을 때 추가

### 🚀 시작 방법
지금 바로 시작하려면:
1. `campaignStages.json` 생성
2. 10개 스테이지 기본 스토리 작성 (각 3-5줄 설명)
3. 스테이지 선택 화면에 표시

**어떤 방향으로 진행할까요?**
- A. 전체 시스템 구현 (Phase 1-5, 6-9일)
- B. 경량 버전 먼저 (2-3일)
- C. Phase 1만 먼저 구현 (1-2일)

---

## 📐 **배경 이미지 & 감정 표현 상세 가이드**

### 🖼️ **배경 이미지 사양 (최종)**

#### **생성 사이즈**
```
1024 x 768px (4:3 비율)
```
- SD로 생성 가능한 사이즈
- 파일 포맷: PNG
- 용량: 300-800KB 목표

#### **표시 방법**
```css
.cutscene-background {
  background-image: url('backgrounds/chapter1.png');
  background-size: cover;      /* 화면에 맞춰 확대 */
  background-position: center; /* 중앙 정렬 */
  width: 100vw;
  height: 100vh;
}
```
- 1024x768 → 1920x1080으로 자동 확대
- 비율 유지하며 크롭 (상하 또는 좌우)
- 배경이므로 품질 저하 허용 ✅

#### **파일 구조 (Variation 시스템)**
```
web/public/backgrounds/
# Stage 1-10 (각 3 variations = 30개)
├── stage_01_training_1.png, stage_01_training_2.png, stage_01_training_3.png
├── stage_02_fire_1.png, stage_02_fire_2.png, stage_02_fire_3.png
├── stage_03_ice_1.png, stage_03_ice_2.png, stage_03_ice_3.png
├── stage_04_lightning_1.png, stage_04_lightning_2.png, stage_04_lightning_3.png
├── stage_05_wind_1.png, stage_05_wind_2.png, stage_05_wind_3.png
├── stage_06_fire_ice_1.png, stage_06_fire_ice_2.png, stage_06_fire_ice_3.png
├── stage_07_storm_1.png, stage_07_storm_2.png, stage_07_storm_3.png
├── stage_08_elite_1.png, stage_08_elite_2.png, stage_08_elite_3.png
├── stage_09_corridor_1.png, stage_09_corridor_2.png, stage_09_corridor_3.png
├── stage_10_final_boss_1.png, stage_10_final_boss_2.png, stage_10_final_boss_3.png
# 기타 배경 (각 3 variations = 9개)
├── fallback_1.png, fallback_2.png, fallback_3.png
├── victory_1.png, victory_2.png, victory_3.png
└── defeat_1.png, defeat_2.png, defeat_3.png
```

**총 39개 배경 (30개 스테이지 + 9개 기타)**

**활용 예시**:
- 씬 전환: 스테이지 진입 → 전투 시작 → 전투 종료
- 재도전: 1회차 → 2회차 → 3회차 (다른 배경)
- 난이도: Normal → Hard → Extreme (분위기 변화)
- 랜덤: 매 플레이마다 랜덤 선택 (다양성)

---

### 🎭 **감정 표현 애니메이션 구현**

#### **1. CSS 애니메이션**

```css
/* 기본 캐릭터 이미지 */
.character-portrait {
  position: absolute;
  top: 20%;
  left: 50%;
  transform: translateX(-50%);
  width: 300px;
  height: 400px;
  transition: all 0.3s ease;
}

.character-portrait img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  filter: drop-shadow(0 10px 30px rgba(0,0,0,0.5));
}

/* Normal: 부드러운 페이드인 */
@keyframes emotion-normal {
  from { opacity: 0; transform: translateX(-50%) translateY(20px); }
  to { opacity: 1; transform: translateX(-50%) translateY(0); }
}

.emotion-normal {
  animation: emotion-normal 0.3s ease-out;
}

/* Angry: 쉐이크 */
@keyframes emotion-angry {
  0%, 100% { transform: translateX(-50%) translateY(0); }
  10% { transform: translateX(-45%) translateY(-5px); }
  20% { transform: translateX(-55%) translateY(5px); }
  30% { transform: translateX(-45%) translateY(-5px); }
  40% { transform: translateX(-55%) translateY(5px); }
  50% { transform: translateX(-45%) translateY(-5px); }
  60% { transform: translateX(-55%) translateY(5px); }
  70% { transform: translateX(-45%) translateY(-3px); }
  80% { transform: translateX(-55%) translateY(3px); }
  90% { transform: translateX(-48%) translateY(-2px); }
}

.emotion-angry {
  animation: emotion-angry 0.5s ease-in-out;
}

.emotion-angry::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(circle, rgba(255,0,0,0.3) 0%, transparent 70%);
  pointer-events: none;
  animation: angry-flash 0.5s ease-in-out;
}

@keyframes angry-flash {
  0%, 100% { opacity: 0; }
  50% { opacity: 1; }
}

/* Happy: 바운스 */
@keyframes emotion-happy {
  0%, 100% { transform: translateX(-50%) translateY(0); }
  20% { transform: translateX(-50%) translateY(-30px); }
  40% { transform: translateX(-50%) translateY(-15px); }
  60% { transform: translateX(-50%) translateY(-20px); }
  80% { transform: translateX(-50%) translateY(-5px); }
}

.emotion-happy {
  animation: emotion-happy 0.6s ease-out;
}

/* Sad: 느린 페이드 + 파란 오버레이 */
@keyframes emotion-sad {
  from { opacity: 0; filter: brightness(1); }
  to { opacity: 1; filter: brightness(0.7); }
}

.emotion-sad {
  animation: emotion-sad 0.8s ease-out;
}

.emotion-sad::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 100, 255, 0.2);
  pointer-events: none;
}

/* Surprised: 급격한 줌인 */
@keyframes emotion-surprised {
  0% { transform: translateX(-50%) scale(1); }
  50% { transform: translateX(-50%) scale(1.2); }
  100% { transform: translateX(-50%) scale(1); }
}

.emotion-surprised {
  animation: emotion-surprised 0.4s ease-in-out;
}

.emotion-surprised::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 150%;
  height: 150%;
  transform: translate(-50%, -50%);
  background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 50%);
  pointer-events: none;
  animation: surprised-flash 0.4s ease-out;
}

@keyframes surprised-flash {
  0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
  50% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
  100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5); }
}
```

#### **2. JavaScript 적용**

```typescript
// utils/cutsceneUtils.ts
export function applyEmotionEffect(
  characterElement: HTMLElement,
  emotion: 'normal' | 'angry' | 'happy' | 'sad' | 'surprised',
  vfxManager: VFXManager,
  position: { x: number; y: number }
) {
  // 기존 클래스 제거
  characterElement.className = 'character-portrait';
  
  // 감정 클래스 추가
  setTimeout(() => {
    characterElement.classList.add(`emotion-${emotion}`);
  }, 10);
  
  // VFX 추가
  switch (emotion) {
    case 'angry':
      vfxManager.playVFX('damage', position.x, position.y, 'enemy');
      audioManager.playSFX('hit', 0.5);
      break;
      
    case 'happy':
      vfxManager.playVFX('buff', position.x, position.y, 'player');
      for (let i = 0; i < 5; i++) {
        setTimeout(() => {
          vfxManager.createParticles({
            x: position.x + (Math.random() - 0.5) * 100,
            y: position.y,
            count: 3,
            color: 0xFFD700,
            speed: 2,
            lifetime: 0.8,
            gravity: -1
          });
        }, i * 100);
      }
      audioManager.playSFX('card_play', 0.6);
      break;
      
    case 'sad':
      // 파란 파티클 하강
      vfxManager.createParticles({
        x: position.x,
        y: position.y - 50,
        count: 10,
        color: 0x4080FF,
        speed: 0.5,
        lifetime: 2,
        gravity: 0.5
      });
      break;
      
    case 'surprised':
      vfxManager.playVFX('energy', position.x, position.y, 'player');
      audioManager.playSFX('card_draw', 0.7);
      break;
      
    case 'normal':
    default:
      // 효과 없음 (페이드인만)
      break;
  }
  
  // 애니메이션 종료 후 클래스 제거
  setTimeout(() => {
    characterElement.classList.remove(`emotion-${emotion}`);
  }, getEmotionDuration(emotion) * 1000);
}

function getEmotionDuration(emotion: string): number {
  const durations: Record<string, number> = {
    normal: 0.3,
    angry: 0.5,
    happy: 0.6,
    sad: 0.8,
    surprised: 0.4
  };
  return durations[emotion] || 0.3;
}
```

#### **3. 사용 예시**

```typescript
// 컷신 대화 처리
function showDialogue(dialogue: Dialogue) {
  const characterElement = document.querySelector('.character-portrait') as HTMLElement;
  const position = {
    x: window.innerWidth / 2,
    y: window.innerHeight * 0.3
  };
  
  // 감정 효과 적용
  applyEmotionEffect(characterElement, dialogue.emotion || 'normal', vfxManager, position);
  
  // 대사 표시
  dialogueText.textContent = dialogue.text;
}
```

---

### 📂 **최종 파일 구조**

```
web/
├── public/
│   ├── backgrounds/           # 🆕 배경 이미지 (1024x768)
│   │   ├── chapter1.png
│   │   ├── chapter2.png
│   │   ├── chapter3.png
│   │   └── fallback.png
│   └── cards/                 # 기존 카드 이미지 (캐릭터 이미지로 활용)
│       ├── Ariana_Attack_Common.webp
│       ├── Ariana_Defense_Rare.webp
│       └── ...
├── src/
│   ├── utils/
│   │   ├── cutsceneUtils.ts   # 🆕 컷신 관련 유틸
│   │   └── storyUtils.ts      # 🆕 스토리 데이터 처리
│   └── data/
│       ├── campaignStages.json  # 🆕 스토리 데이터
│       └── dialogues/
│           ├── ko.json          # 🆕 한국어 대사
│           └── en.json          # 🆕 영어 대사
└── index.html
    └── <div id="cutscene"></div>  # 🆕 컷신 화면
```

---

### ✅ **준비 체크리스트**

#### **당신이 준비할 것**
- [ ] 배경 이미지 PNG **39개** (13종 × 3 variations) ⭐ Variation 시스템
  - **사이즈**: 1024x768px
  - **포맷**: PNG
  - **저장 위치**: `web/public/backgrounds/`
  - **파일명**: `stage_01_training_1.png`, `stage_01_training_2.png`, `stage_01_training_3.png`...
  - **프롬프트**: `배경_이미지_SD_프롬프트.md` 참조

**생성 우선순위** (Variation 시스템):
1. **1단계** (9개): Stage 1, 6, 10 (각 3 variations) - 대표 배경
2. **2단계** (15개): Stage 2, 3, 4, 5, 7 (각 3 variations) - 속성별 배경
3. **3단계** (6개): Stage 8, 9 (각 3 variations) - 나머지
4. **4단계** (9개): Fallback, Victory, Defeat (각 3 variations) - 보너스

**Variation 생성 팁**:
- Seed 변경 (랜덤)
- 조명/시간대 변경 (아침/정오/노을)
- 날씨/분위기 변경 (맑음/안개/폭풍)
- 앵글 변경 (정면/측면/광각)
- 요소 강도 변경 (약함/중간/강함)

#### **구현할 것 (개발)**
- [ ] 배경 이미지 CSS 처리 (`background-size: cover`)
- [ ] **Variation 시스템 구현** 🆕
  - [ ] 배경 선택 로직 (씬/재도전/난이도/랜덤)
  - [ ] `getBackgroundVariation(stageId, context)` 함수
  - [ ] 씬 전환 시 배경 변경 애니메이션
- [ ] 감정별 CSS 애니메이션 (5종)
- [ ] VFX 통합 (angry: 섬광, happy: 파티클 등)
- [ ] 캐릭터 이미지 = 카드 일러스트 매핑
- [ ] 컷신 UI 구현
- [ ] 모바일 반응형 레이아웃

---

### 🎯 **SD 프롬프트 상세 가이드**

#### **📄 별도 문서 참조**
**10개 스테이지 + 3개 보너스 배경의 상세한 SD 프롬프트는 다음 문서를 참조하세요:**

👉 **`배경_이미지_SD_프롬프트.md`** 👈

#### **포함 내용**
- ✅ 10개 스테이지별 상세 프롬프트
- ✅ Positive/Negative 프롬프트 전체
- ✅ 추천 색조 및 분위기 가이드
- ✅ 생성 설정 (Steps, CFG Scale 등)
- ✅ 후처리 최적화 팁
- ✅ 파일 명명 규칙
- ✅ 우선순위별 생성 가이드

#### **간단 예시 (Stage 1, 2, 10)**

**Stage 1: 입문 - 벨몬트 훈련장**
```
Positive: medieval fantasy training ground, bright sunny day, 
stone castle, green grass, peaceful atmosphere, 1024x768
Negative: people, characters, dark, modern
```

**Stage 2: 불의 시련 - 화산 지대**
```
Positive: active volcano landscape, flowing lava rivers, 
red and orange glowing, dramatic lighting, 1024x768
Negative: people, characters, ice, snow, peaceful
```

**Stage 10: 최종 보스 - 벨몬트 대전투장**
```
Positive: grand throne room, massive chamber, dark purple lighting,
golden throne, magical orbs, majestic atmosphere, 1024x768
Negative: people, characters, small room, bright sunny
```

**→ 전체 프롬프트는 `배경_이미지_SD_프롬프트.md` 참조**

