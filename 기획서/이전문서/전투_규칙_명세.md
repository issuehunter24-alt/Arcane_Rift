## 전투 규칙 명세

### 1. 턴/라운드 흐름(동시 선언·동시 공개 + 우선순위)
- 선언: 양측이 에너지 한도 내에서 액션(카드)을 비공개로 선택하여 큐에 넣는다.
- 락인/타겟 확정: 선언 종료 시 비용 예약 차감, 대상 타입에 따라 타겟을 스냅샷.
- 공개: 양측 큐를 동시에 공개.
- 우선순위 산정: 속도(특수>공격>방어>회복) > 코스트 > 라운드 이니셔티브 > 난수 시드.
- 해결: 우선순위 순서대로 효과 적용. 반응 창은 지정된 키워드(무효/카운터)에 한해 1회 개입.
- 정리: 소진/버림, 지속효과 틱 준비, 이니셔티브 교대.

### 2. 타겟 확정 정의
- 1:1에서도 카드가 요구하는 대상 타입(자기/적/양쪽/무작위/조건부)을 그 순간 게임 상태로 스냅샷하여 고정.
- 타겟 불가 시 실패 처리 규칙: 비용 소모 유지 또는 환불(카드별 속성으로 정의).

### 3. 비용/자원
- 기본 에너지 3/턴, 상한 10. 일부 특수로 변조 가능(일시적 상향/하향).
- **에너지 캐리오버**: 턴 종료 시 남은 에너지는 다음 턴에 이월됨 (이월 에너지 + 3, 최대 10까지).
  - 예: 턴1에서 1 사용 → 2 남음 → 턴2 시작 시 2(이월) + 3 = 5 에너지
  - 전략적 에너지 관리로 고코스트 카드 사용 가능
- 비용은 락인 시 예약 차감, 무효 처리 시 환불 여부는 카드 속성에 따름.

### 4. 효과 처리/충돌 규칙
- 피해/회복 공식: base ± modifiers(버프/디버프/태그) → 퍼센트 보정(취약/경감) → 최소값 0 보장.
- 동시효과: 같은 프레임 충돌 시 플레이어 우선 → 턴 오너 → 환경효과.
- 중첩: 동일 명칭은 가산, 다른 키워드는 개별 계산 후 합산. 상/하한 존재.

### 5. 상태이상/지속효과 틱
- 틱 타이밍: 턴 시작에 감소/적용. 행동 수 변조(빙결 등)는 틱 전에 적용.
- 해제/면역: 키워드에 면역 태그가 있으면 적용되지 않음.

### 6. 멀리건/손패/소진
- 멀리건: 첫 손패 0~2장 교체 허용. 손패 상한 10.
- 소진(Exhaust): 지정 카드 사용 시 전투 중 재사용 불가.

### 7. 승패/무승부
- 승리: 상대 HP 0, 패배: 아군 HP 0, 무승부: 동시 사망 시 라운드 수 기준 재경기 또는 무승부 판정(모드별).

### 8. 우선순위 계산(상세)
- 기본속도: Special > Attack > Defense > Heal
- 동률 1차: 카드 코스트 높은 순
- 동률 2차: 라운드 이니셔티브 보유자 우선(라운드마다 교대)
- 최종 동률: 난수 시드에 따른 무작위(로그에 시드/결과 기록)
- 동일 주체의 다중 카드: 선언 순서가 늦을수록 우선도 낮음(스스로의 스택 충돌 방지)

### 9. 반응 창(제한적 대응)
- 개입 가능 키워드: 무효(Nullify), 카운터(Counter) 태그가 있는 카드만 라운드 해결 중 지정 타이밍 1회 개입 가능
- 타이밍: 대상이 되는 카드가 우선순위로 ‘해결 직전’인 프레임에서 삽입 처리(상단 스택)
- 비용/환불: 반응 카드도 비용 규칙 동일. 무효 성공 시 원카드 환불 여부는 카드 속성에 따름

### 10. 예시 시나리오
- 사례 A) 양측 공격 동시 공개: A(Attack 코스트3), B(Attack 코스트1)
  - 우선순위: 둘 다 Attack → 코스트 비교 → A가 선해결, 이후 B 해결
  - 동시 사망 시: 무승부 규칙 적용
- 사례 B) Nullify 개입: A의 Attack 해결 직전 B가 Nullify 사용
  - 스택: B의 Nullify 먼저 해결 → A의 Attack 무효 → A 비용 환불 여부는 A카드 속성 참조
- 사례 C) 조건부 타겟: “HP 30% 이하 적 대상” 카드
  - 타겟 확정: 락인 시점의 체력 기준으로 스냅샷. 이후 회복이 일어나도 대상 변경 없음
- 사례 D) 전체 타겟과 소환 충돌
  - 전체 타겟: 락인 시점의 유닛 리스트로 고정. 공개 이후 새 소환/사망은 해당 리스트에 영향 없음

### 11. 엣지 케이스 처리
- 타겟 부재: 타겟 후보가 0명 → 카드 속성에 정의된 실패 처리(비용 소모/부분 환불/완전 환불)
- 면역/저항: 대상이 키워드 면역이면 효과 미적용(로그에 ‘면역’ 플래그)
- 동시 치명타/도트 처리: 라운드 내 해결 순서에 따라 즉시 적용, 틱 데미지는 다음 턴 시작에 일괄 적용
- 소진 카드 취소: 락인 후 무효 처리되어도 소진 여부는 카드 속성 따름(기본: 무효 시 소진되지 않음)
- 타이머 초과(AFK): 선언 타이머 초과 시 추천/자동선택 1장 또는 ‘패스’ 처리(큐 UX 정책)

### 12. 로그/리플레이/시드 정책
- 시드: 라운드 단위 난수 시드 기록, 타겟 무작위/동률 결정에 사용
- 리플레이: 선언 목록, 시드, 우선순위 결과, HP 변화, 키워드 변경을 순차 기록
- 프라이버시: PvP 공개 로그에서 상대 핸드 정보는 비공개, 공개 시점의 카드만 기록



