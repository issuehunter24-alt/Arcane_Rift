## 카드배틀 게임 기획서 개요 (현 카드 구성 기반)

### 1) 게임 콘셉트
- **장르**: 캐릭터 수집형 턴제 카드배틀
- **핵심 판타지**: 각 캐릭터 고유 일러스트와 카드로 전투. 타입(Attack/Heal/Special/Defense) 조합과 등급(R/N/E/L)별 파워 곡선으로 전략적 덱 운영.
- **플랫폼**: **웹 우선(Web-first)** — 데스크톱/모바일 브라우저 대응(카드 규격 768x1024 기준, 반응형 스케일링).

### 2) 카드 시스템
- **카드 타입**: Attack, Heal, Special, Defense
  - Attack: 직접 피해/버스트 딜, 상태이상 유도(빙결, 감전 등)와 연계.
  - Heal: 즉시/지속 회복, 버프와 혼합(공격력 증가 등).
  - Special: 행동력/사용권 변조, 무효화/추가사용 등 전술 기믹.
  - Defense: 피해 경감/실드/카운터, 적 디버프.
- **등급/프레임**: Normal, Rare, Epic, Legendary → 프레임로어/연출 차등, 드랍률/제작비용/강화 상한 차등.
- **코스트**: 정수 기반(현재 카드 데이터 준수). 턴당 **기본 3 에너지**에서 시작, 일부 Special로 변조.
- **문구/효과 템플릿**: `피해`, `회복`, `버프/디버프(퍼센트/턴수)`, `행동력`, `무효화`, `다중타격/조건부 강화` 등 표준화.
- **카드 해상도**: 768x1024 고정, 타입 아이콘 좌상단, 이름/코스트 상단, 효과창 하단.

### 3) 캐릭터/덱 구성
- **캐릭터**: Ariana, Darius, Elder, Elena, Garen, Iris, Kai, Leon, Lucian, Marcus, Mira, Seraphina, Seraphine.
- **덱 규칙(초기안)**:
  - 덱 20장, 동일 카드 최대 3장, Legendary는 1장 제한.
  - 캐릭터 파벌/가문 제약 없음(초기 빌드 단순화). 추후 시너지 태그 추가 가능.
  - 시작 핸드 5장, 턴 시작 시 1장 드로우, 핸드 상한 10장.

### 4) 전투 규칙(턴 구조)
- 1) 턴 시작: 에너지 3 회복(최대 10), 카드 1장 드로우, 지속효과 틱 처리.
- 2) 메인 페이즈: 에너지 내에서 라운드 액션을 선택(비공개 큐에 저장). 즉시 실행 없음.
- 3) 종료 페이즈: 라운드 공개·해결 후 정리(버리기 선택 등).
- 승리 조건: 적 HP 0 도달, 패배는 아군 HP 0.

- 턴 처리 모델(기본안: 라운드 동시 선언·동시 공개 + 우선순위 해결)
  - 선언: 양측이 에너지 한도 내에서 카드 0~N장을 선택해 비공개 큐에 넣음(기본 1장, 모드에 따라 2장 허용 가능).
  - 락인/타겟 확정: 선언 종료 시 각 카드의 비용을 예약 차감하고, 대상 타입에 따라 타겟을 스냅샷.
  - 공개: 양측 큐를 동시에 공개.
  - 우선순위 산정: 각 카드에 대해 우선순위 점수 계산 → 높은 순으로 해결.
    • 기본속도: Special > Attack > Defense > Heal
    • 동률 1차: 카드 코스트 높은 순
    • 동률 2차: 라운드 이니셔티브 보유자 우선(라운드마다 교대)
    • 최종 동률: 난수 시드로 결정(로그 기록)
  - 해결: 우선순위 순서대로 효과 적용. 반응 창은 최소화(태그가 Counter/Nullify인 카드만 지정 타이밍에 1회 개입 가능).
  - 정리: 소진/버림 처리, 지속효과 틱 준비, 다음 라운드로 이니셔티브 교대.

- 대안 모드(옵션: IGOUGO)
  - 액티브가 메인 페이즈 수행, 상대는 반응 윈도우에서 1회 대응. 초기 PvE에 적합하며 규칙 단순.

### 5) 상태이상/키워드(초기 셋)
- 화상: 매 턴 시작 피해(예: 10) 2턴
- 빙결: 적 행동 -1턴, 방어 증가와 상쇄 가능
- 감전: 다음 공격 추가타/연쇄 확률 부여
- 바람 보호: 공격 1회 무효(방어 계열과 중첩 규칙 명시)
- 취약: 받는 피해 +20%

### 6) 밸런싱 가이드(초안)
- **등급 곡선**: N=기본, R=+15% 파워/효율, E=+30%와 추가효과 한 개, L=+45%와 조건부 강화.
- **코스트 대 피해(공격)**: 코스트 1→20±, 2→35±, 3→50±, 광역은 -20% 보정.
- **코스트 대 회복(힐)**: 1→20, 2→40, 3→60, 부가 버프 시 -10~-20% 보정.
- **방어 기대값**: 코스트×30% 피해경감 기대, 무효계는 조건/쿨다운 필요.

### 7) 메타/시너지(확장 여지)
- 태그: 불/얼음/번개/바람, 가문(Drake/Belmont 등), 무기/마법/성직.
- 시너지 예: 불 태그 2장 이상 사용 시 다음 화염 공격 +10 피해. 빙결 후 번개 공격 시 추가 연쇄.

### 8) 수집/진행
- 카드 획득: 스테이지 보상, 상점, 제작(재료), 이벤트 상자.
- 강화: 동일 카드 합성(동일 등급 2→+1 레벨), 레벨당 수치 +5% 상한.
- PvE 캠페인 → 챌린지 모드 → 일일 던전(속성/보스 로테이션).

### 9) UI/UX
- **카드 뷰어**: 확대/프레임/아이콘 표시, 효과 툴팁 표준 템플릿.
- **덱 편집기**: 타입/등급/코스트 필터, 중복 카운트, 곡선 그래프(코스트/타입 비율).
- **전투 UI**: 에너지, 턴 순서, 상태이상 아이콘, 로그(간략/상세).

### 10) 아트/파이프라인
- 카드 프레임: 등급별 `frame_{Rarity}_*.png`, 타입 아이콘 좌상단 92×92.
- 합성 규격: 768×1024, 폰트 Malgun/Arial 대체, `magick` 배치 스크립트 자동화.
- 산출물 관리: `Cards/Characters/.../final_{Rarity}.png` → `Cards/AllCards` 수집.
- 웹 최적화: 카드 PNG를 WebP/AVIF로 변환(무손실/품질 85), 스프라이트 아틀라스/지연 로딩, 해상도별 프리셋(1x/1.5x/2x) 생성.

### 11) 기술 스택(시제품)
- 클라이언트(웹): TypeScript + PixiJS(경량) 또는 Phaser(씬/입력 포함 프레임워크)
- 상태/데이터: Zustand/Redux + JSON(카드 DB), LocalStorage/IndexedDB 세이브
- 빌드/번들: Vite + PNPM, 코드스플리팅/지연 로딩
- 배포: Cloudflare Pages/Netlify + CDN 캐시, 도메인/HTTPS
- 툴링: PowerShell + ImageMagick(아트 합성) + Node 스크립트(WebP 변환/스프라이트)

### 11-1) 대안: 게임 엔진 없이 파이썬(Pygame) 구현 가능 여부
- **목표 범위(MVP)**: 2D 해상도 고정(카드 768x1024), 턴 시스템, 에너지/드로우/사용, 기본 이펙트(페이드/이동), 마우스 입력, 덱 편집 간이 UI.
- **사용 라이브러리**: `pygame`(렌더/입력/사운드), `json/csv`(데이터), 선택적으로 `Pillow`(이미지 전처리).
- **장점**: 가볍고 빠른 프로토타이핑, 배포 단순(pyinstaller), 엔진 종속성 없음, 현 파이프라인(이미지 합성/자산 폴더) 그대로 재사용.
- **단점/리스크**: 고급 UI/애니메이션 툴 부재, 반응형/해상도 스케일링 보일러플레이트 필요, 에디터/타임라인 없음, 온라인/멀티 지원 한계, 장기 유지/효율적 워크플로는 엔진 대비 불리.
- **개발 공수(예상)**: 1인 기준 MVP 2~3주(전투 코어/덱/기본 UI), 연출/효과 확장 1~2주 추가.
- **권고**: 아이디어 검증/프로토타입은 충분히 가능. 상용 품질/확장(애니/이펙트/멀티/툴링)까지 고려 시 게임 엔진 전환 권장.

### 11-2) 웹 기반 구현(전제)
- **목표**: 설치 없이 즉시 플레이, PC/모바일 브라우저 호환, 60FPS 타겟.
- **렌더/입력**: PixiJS(WebGL) + 커스텀 UI 레이어(카드 드래그/클릭/툴팁), 모바일 터치 제스처 지원.
- **에셋 관리**: 프리로드 매니페스트, LQIP(저해상도 프리뷰) → 고해상도 지연 로딩, 메모리 상한 정책(카드 텍스처 언로드).
- **반응형**: 기준 캔버스 1536×1024(예), 카드 768×1024를 비율 스케일, UI는 앵커 기반 오토레이아웃.
- **오디오**: WebAudio API(버튼/히트/버프 SFX), BGM 루프.
- **세이브/백엔드**: Supabase(Postgres + Auth) 기반 계정/클라우드 세이브. 로컬 저장은 캐시/오프라인 용도로만 사용하고, 공식 진행도는 서버 동기화.
- **성능**: 텍스처 아틀라스, 배치 렌더, 드로우콜 최소화, 모바일 VRAM 프로파일링.
- **테스트/배포**: Playwright 스냅샷 테스트, GitHub Actions CI → Pages/CDN 자동 배포.

### 11-3) 계정/세이브 백엔드 (Supabase)
- **인증**: Supabase Auth (이메일/비밀번호 기본). 추후 Google/Apple OAuth 확장 가능.
- **주요 테이블 스키마**
  - `profiles(user_id PK, display_name, locale, created_at, updated_at)`
  - `saves(user_id FK, save_blob JSONB, version INT, updated_at TIMESTAMP)` — 덱, 캠페인 진행, 재화 등 전체 진행도를 JSONB로 저장
  - `collections(user_id FK, card_id, copies_owned INT, last_updated TIMESTAMP)`
  - `daily_progress(user_id FK, date_key TEXT, cleared_floor_ids JSONB, updated_at TIMESTAMP)`
  - `match_history(id SERIAL, user_id FK, opponent_id FK NULL, mode TEXT, result TEXT, seed BIGINT, payload JSONB, created_at TIMESTAMP)`
- **Row Level Security**: 모든 테이블 `auth.uid() = user_id` 조건으로 읽기/쓰기 제한, `match_history`는 `user_id = auth.uid() OR opponent_id = auth.uid()` 허용.
- **Edge Function**: PvP 매치메이킹/검증용 함수는 추후 추가. 현재는 클라이언트에서 Supabase REST 호출 + RLS 검증으로 MVP 구축.
- **동기화 전략** (구현 완료): 로그인 시 `saves` 테이블에서 JSON 세이브 로드 → 캠페인 클리어/재화/덱/컬렉션/일일 던전 상태를 스토어에 주입 → 상태 변경은 디바운스(upsert)로 자동 저장. 세이브 버전 충돌 시 타임스탬프 비교 후 최신 기록 유지.

### 12) 출시 범위(MVP) — 웹 기반 PvE 중심
- 전투 코어: 동시 선언·동시 공개 + 우선순위 해결, 에너지 3/턴, 선언→락인(타겟 스냅샷)→공개→우선순위→해결.
- 카드/키워드: Attack/Heal/Special/Defense, 핵심 키워드 5종(화상/빙결/감전/무효/취약), 소진(Exhaust) 도입.
- 컨텐츠: 싱글 PvE 캠페인 10스테이지(속성 테마/보스 약점), 일일 던전 1종.
- 덱/빌드: 덱 20장(레전더리 1장 제한), 같은 카드 3장 제한, 기본 시너지(속성 태그 보정) 2종.
- 경제: 드랍률(N/R/E/L=62/25/10/3), 상점(기본가/일일 할인), 제작(조각), 중복 보호 기본(조각 환원).
- UX/성능: 반응형 UI, 툴팁/키워드 하이라이트, WebP/아틀라스/지연 로딩, 60fps 타깃(모바일 30fps 폴백).
- 분석/QA: 전투 로그, 기본 텔레메트리(승률·턴수), E2E 스냅샷, Chrome/Safari/Edge 최신 2버전 지원.

### 13) 개발 로드맵(마일스톤)

- 마일스톤 M0 — 인프라/파이프라인(1주)
  - Vite + TypeScript + PixiJS/Phaser 보일러플레이트, 상태관리(Zustand/Redux)
  - 카드 DB(JSON) 변환 파이프라인(카드 리스트 → JSON), CDN 배포/캐시 버저닝
  - 아트 파이프라인(WebP 변환/스프라이트 아틀라스), LQIP/프리로드 플로우

- 마일스톤 M1 — 전투 코어/MVP 전투(2주)
  - 동시 선언·동시 공개 루프, 우선순위 계산(속도>코스트>이니셔티브>시드)
  - 타겟 확정 스냅샷, 키워드 5종, 로그/리플레이용 시드 기록(로컬)
  - 덱 편집/코스트/드로우/소진, 기본 이펙트(페이드/슬라이드/숫자팝업)

- 마일스톤 M2 — 컨텐츠/메타(2주)
  - 캠페인 10스테이지/보스, 일일 던전 1종, 상점/제작/드랍 테이블
  - 기본 시너지 2종(예: 얼음→번개 연쇄, 불 연소 스택) 적용
  - 밸런스 1차 패스(시뮬레이터 10k 전투)

- 마일스톤 M3 — 품질/UX/성능(1주)
  - 반응형 레이아웃, 모바일 터치 최적화(48dp 영역, 제스처), 접근성(텍스트 크기/대비)
  - 초기 로딩 3초 목표, 인전트 로딩, 에러/토스트, 튜토리얼
  - 텔레메트리 대시보드(기본 지표), 핫픽스 데이터 분리(서버/클라)

- 마일스톤 M4 — 경쟁/재방문(선택 2주)
  - 드래프트/아레나(동시 공개 룰 최적), 주간 이벤트 로테이션
  - 아티팩트(유물) 2~3 슬롯, 전투 시작 패시브(캐릭터 특성)
  - 랭크/MMR 베타(보호구간/승급전), 시즌 파운데이션(6~8주)

- 마일스톤 M5 — 출시/라이브(1주)
  - 릴리즈 하드닝, 브라우저/디바이스 매트릭스 인증
  - 운영: 주간 메타 리포트, 밸런스 핫픽스 루틴, 이벤트/상점 로테이션

### 14) 리스크/대응
- 다국어/인코딩: 데이터-런타임 UTF-8 통일, 키-값 리소스 분리.
- 밸런스: 자동 시뮬/전투 리플레이, 메트릭 기반 조정 파이프라인.
- 아트 해상도: 768x1024 고정 규격 준수, 업스케일/크롭 자동화 유지.

### 15) 부록: 카드 데이터 표준 필드
- id, name, type(Attack/Heal/Special/Defense), rarity(N/R/E/L), cost, effect, tags([]), leveling({base, perLevel}), vfx/sfx key.


### 16) 전투 규칙 상세(해결/중첩/타이밍)
- **해결 순서**: 카드 사용 → 비용 차감 → 타겟 확정 → 효과 적용 → 트리거/후처리 → 로그 기록.
- (정의) 타겟 확정: 1:1에서도 카드가 요구하는 대상 타입을 그 시점에 고정하는 절차. 예) 버프·회복은 자기, 디버프·공격은 적, 양쪽/전체/무작위/조건부는 해당 규칙에 따라 목록을 스냅샷.
- **동시효과**: 같은 프레임 발생 시 카드 플레이어 우선, 이후 턴 오너, 마지막으로 환경효과.
- **스택/큐**: 기본은 큐 처리(선입선출). 즉시반응형 트리거는 미니스택으로 우선 처리.
- **피해/회복 공식**: base ± modifiers(버프/디버프/태그 보정) → 취약/감소 퍼센트 적용 → 최소값 하한(0) 보장.
- **버프/디버프 중첩**: 동일 명칭은 가산, 상이 키워드는 개별 계산 후 합산. 상한/하한 정의.
- **지속효과 틱**: 턴 시작에 먼저 감소/적용. 빙결 등 행동 수 변조는 틱 전 적용.
- **타겟팅**: 단일/전체/무작위/조건부(HP 기준 등). 타겟 불가 시 실패 로그 및 비용 소모 유지.
- **멀리건/첫 손패**: 0~2장 교체 허용(튜토리얼 제외). 첫 손패 코스트 합 상한 보정.
- **소진(Exhaust)**: 특정 카드(주로 Legendary/Special)는 사용 시 전투 중 소진 영역으로 이동.

### 17) 카드/데이터 사양(스키마/키워드)
- **카드 스키마**: { id, name, type, rarity, cost, effectText, tags[], keywords[], levelCurve, vfxKey, sfxKey, version }.
- **키워드 정의**: 화상(턴당 피해, 2턴), 빙결(행동 -1, 1턴), 감전(다음 공격 연쇄 확률), 무효(공격 1회 무효), 취약(피해 +20%).
- **데이터 소스**: `카드/CardList_Formatted.md` → 변환 파이프라인(JSON) → 런타임 로딩.
- **버전 관리**: 카드 `version` 증가 시 마이그레이션 규칙(세이브 호환) 명시.

### 18) 밸런스/확률(드랍/상점/기대값)
- **드랍률**: N 62%, R 25%, E 10%, L 3% (초안). 이벤트/상점 보정 가능.
- **상점 가격**: 등급 계수(N=1, R=2, E=4, L=8) × 기본가. 일일 할인 슬롯 1개.
- **코스트-효과 표준**: 단일/광역/조건부 보정치 명시(광역 -20%, 조건부 +0~+30%).
- **테스트**: 전투 시뮬레이터로 10k 매치 자동 평가, 승률/턴수/에너지 잔량 메트릭 수집.

### 19) 진행/메타(캠페인/재화)
- **캠페인**: 10 스테이지, 각 속성 테마/규칙(불/얼음/번개/바람). 보스는 키워드 저항/약점 보유.
- **재화**: 골드(상점), 조각(제작), 티켓(이벤트). 일일/주간 한도 및 파밍 루프 정의.
- **강화**: 동일 카드 2장 → +1레벨, 레벨당 +5% 상향(상한 설정).

### 20) 웹 기술 세부(반응형/에셋/CDN)
- **해상도**: 기준 캔버스 1536×1024, 카드 768×1024 비율 스케일. 모바일 브레이크포인트(≤900px) 레이아웃 축약.
- **에셋 파이프라인**: PNG → WebP(품질 85)/AVIF 변환, 스프라이트 아틀라스, 지연 로딩 및 프리로드 매니페스트.
- **CDN**: 파일명에 해시 버전 부여, 캐시 무효화 규칙 배포 자동화.

### 21) 성능/품질(예산/폴백)
- **프레임 타깃**: 60fps. 모바일 저사양은 30fps 폴백 옵션.
- **메모리 예산**: 텍스처 VRAM 상한(모바일 256MB 초안), 비가시 카드 언로드.
- **렌더**: 드로우콜 최소화(배치/정렬), 텍스처 재사용, 알파 블렌딩 레이어 정리.

### 22) 저장/온라인(선택 기능)
- **세이브**: LocalStorage/IndexedDB(JSON). 충돌 시 최신 타임스탬프 우선.
- **클라우드**: Supabase Auth(이메일/비밀번호) + Postgres. OAuth 확장은 선택.
- **리더보드/이벤트**: 서버리스 API(Workers) 호출, 인증 토큰 만료/재발급 정책.

### 23) 보안/치트(웹)
- **클라 신뢰 최소화**: 전투 계산 검증 필요한 모드에서는 서버 authoritative(추가 과업). 싱글PvE는 로컬 허용.
- **난수**: 시드 로깅, 재현 가능 리플레이(디버그용). 네트워크 모드 시 서버 시드.

### 24) UX/UI(와이어프레임/접근성)
- **핵심 화면**: 전투, 덱 편집, 보상, 상점. 툴팁 표준 템플릿.
- **입력**: 드래그/탭/롱탭 제스처, 모바일 터치 영역 확대, 키보드 단축키(PC).
- **접근성**: 텍스트 크기 옵션, 고대비 모드, 색각 보정 프리셋.

### 25) 오디오/이펙트(최소 사양)
- **SFX/BGM**: 버튼/히트/버프/승패 SFX, 루프 BGM 1종 이상. 볼륨 믹스 규칙.
- **이펙트**: 페이드, 슬라이드, 숫자 팝업, 히트 플래시. 향후 셰이더 이펙트 확장 지점 명시.

### 26) 로깅/분석(텔레메트리)
- **이벤트 스키마**: 전투 시작/종료, 카드 사용, 승패, 이탈, 오류. PII 최소 수집.
- **대시보드**: 승률, 평균 턴수, 카드 사용 빈도, 스테이지 클리어율.

### 27) QA/출시(CI/CD/지원 매트릭스)
- **테스트**: E2E(Playwright), 스냅샷(렌더/레이아웃), 리그레션.
- **브라우저/디바이스**: Chrome/Safari/Edge 최신 2버전, iOS/Android 주요 해상도.
- **CI/CD**: GitHub Actions → Pages/CDN 배포, 버저닝/릴리즈 노트 정책.


