# 현재 서비스 소개서

최종 업데이트: 2025-11-09  
작성자: GPT-5 Codex 지원

---

## 1. 서비스 한눈에 보기
- **서비스명**: 빈틈없는 악역영애 카드 배틀 (가칭)  
- **장르**: 스토리 기반 전략 카드 배틀 (PvE & PvP)  
- **플랫폼**: 웹 (데스크톱/모바일 브라우저, Vite 기반 SPA)  
- **운영 상태**: MVP 라이브 서비스, Supabase 기반 인증·데이터 연동

## 2. 세계관 & 콘셉트
- **IP 콘셉트**: “빈틈없는 악역영애가 회귀했다면, 이번엔 가문 인정받을 때까지 그만둘 수 없어” 세계관을 무대로 한 원작형 카드 배틀.
- **주요 캐릭터**: 세라피나 벨몬트(주인공), 루시안 로즈가든, 아리아나 드레이크 등 드라마틱한 가문 서사를 지닌 캐릭터들이 카드와 컷신에 등장.
- **시각 톤앤매너**: 픽시JS 기반 실시간 전투 캔버스 + 고해상도 카드/배경 아트, 화려한 파티클 VFX, 블루 톤의 귀족풍 UI.
- **서사 구조**: 캠페인 스테이지마다 배경 설명과 전투 전/후 컷신 대화가 내장되어 유저 몰입도 제고.

## 3. 타깃 사용자
- **Primary**: 여성향 스토리 카드 게임을 선호하는 20~30대 초반, 웹/모바일에서 서사형 게임을 즐기는 코어 유저.
- **Secondary**: 전략 카드 배틀/수집형 RPG에 익숙한 하드코어 유저, PvP 실력 경쟁을 선호하는 유저.
- **핵심 니즈**: 감정선이 뚜렷한 서사 경험, 수집/성장 동기, 매일 반복 가능한 도전 콘텐츠, 경쟁 콘텐츠.

## 4. 핵심 가치 제안
- **스토리와 전략의 결합**: 컷신·대화 기반 캠페인 스테이지와 본격 카드 배틀 규칙이 긴밀히 연결.
- **클라우드 연동 플레이**: Supabase 인증 및 자동 저장(Cloud Save)으로 멀티 디바이스 플레이/데이터 보전.
- **하루 한 번의 숙련 루프**: 일일 던전, 상점, 미션을 통한 반복 접속 동기.
- **실시간 경쟁의 긴장감**: Supabase Realtime을 활용한 PvP 매칭과 15초 단위 턴 제한이 주는 압박감.

## 5. 주요 기능 상세

### 5.1 계정·클라우드 연동
- 이메일/비밀번호 기반 **Supabase Auth** (로그인/회원가입/자동 세션 갱신).
- `useAuthStore`를 활용한 오버레이 UI, 에러 메시지, 뷰 전환, 로그아웃 후 화면 초기화.
- `cloudSave.ts`를 통한 골드/파편/덱/캠페인 진행/일일 던전 상태 저장. 이벤트 기반 자동 저장(250ms 디바운스) 및 강제 저장 트리거.
- 브라우저 `beforeunload` 및 `pagehide` 이벤트 접수해 PvP 큐 상태 클린업.

### 5.2 카드 수집 & 덱 편집
- `public/data/cards.json` 기반 169장 카드 수록 (PNG/WebP 이중 포맷, PowerShell 스크립트로 변환 자동화).
- 카드 데이터는 `Card` 타입(공격/방어/회복/특수, 희귀도, 키워드, 효과 구조)으로 정규화.
- `deck-editor` UI에서 컬렉션/덱/통계 탭 제공, 모바일 전환 시 탭 네비게이션으로 재구성.
- 덱 스냅샷(최대 20장) & 카드 ID 정규화를 통해 PvP/클라우드 저장 시 중복 관리.

### 5.3 전투 시스템
- PixiJS `Application` 기반 전투 캔버스, `playerHandPool`/`enemyHandPool` 등 오브젝트 풀 관리.
- **라운드 구조**: 선언 → 잠금 → 공개 → 해석(효과) → 상태 처리, 에너지 최대 10.
- 다양한 상태이상(화상, 감전, 취약, 무효화, 회피 등)과 버프/디버프, 체인 공격, 조건부 카드 로직.
- `vfxManager`, `tweenNumber`, `audioManager` 통합으로 시각·청각 피드백 강화.
- `toastManager`, `loadingManager`로 사용자 알림 및 로딩 상태 관리.

### 5.4 캠페인 모드
- `store.ts` 내 20개 이상 스테이지 정의 (권장 전투력, 최초/반복 보상, 배경 이미지, 캐릭터 일러스트).
- 각 스테이지에는 전투 전/후 컷신 대화(감정, 초상화)와 배경 설명을 포함.
- 스테이지 클리어 데이터는 클라우드 저장 및 UI 상 정렬/진행도 표시.

### 5.5 일일 던전
- 날짜 기반 Seed로 층 구성(`generateDailyDungeonFloors`): 추천 전투력, 골드/파편 보상, Modifier(플레이어 에너지 증가, 적 보호막 등).
- 클리어 여부/현재 층 진행도를 클라우드에 저장하여 매일 갱신.
- 일일 던전 완료 시 반복 플레이 대비 성장 루프 제공.

### 5.6 상점 & 보상
- 캠페인 최초/반복 보상, 일일 던전 층별 보상, `getBoostedStageReward`로 고정 보상에 스테이지 기반 가중 적용.
- 상점 UI는 일일 특가, 카드/자원 구매 버튼, Supabase 동기화 예정 구조로 구현.

### 5.7 PvP 모드
- Supabase Table `pvp_queue` + Realtime 채널 기반 매칭 대기열, 매칭 성공 시 시드/상대 덱 스냅샷 전달.
- 매 라운드 15초 턴 타이머(`DEFAULT_PVP_TURN_DURATION`), 턴 제출 후 양측 큐 비교 및 효과 해석.
- 매칭 중 UI: 상태 인디케이터(대기/매칭/매칭완료/오류), 상대 정보 패널, 검색/취소 버튼.

### 5.8 UI·UX 보강 요소
- 다국어 지원(한국어/영어) 및 누락 키 탐지(`i18n.ts`).
- 튜토리얼 힌트 문자열, 토스트 아이콘/메시지, 인증 에러/성공 안내.
- 반응형 디스플레이: 모바일 뷰에서 덱 편집 슬라이더/탭, PvP 레이아웃 조정.

### 5.9 사운드 & 연출
- `audioManager`: 로컬 스토리지 기반 볼륨/뮤트 설정, BGM 페이드 인/아웃, SFX 중첩 재생.
- `vfxManager`: 파티클 폭발, 스프레이, 버프 연출 등 전투 효과 제공.
- `tweens.ts`: 숫자 인터폴레이션, UI 애니메이션.

### 5.10 데이터 품질 관리
- `scripts/validateCards.js`, `scripts/pruneCardsToAssets.js`로 카드 데이터/에셋 정합성 체크.
- `npm run assets` 파이프라인으로 카드 PNG 복제 + WebP 변환 자동화.
- Vitest 기반 테스트(`__tests__/cardEffects.test.ts` 등)로 카드 효과·우선순위 로직 검증.

## 6. 이용자 여정
1. **첫 진입**: 인증 오버레이 → 회원가입/로그인 → 프로필/닉네임 설정.
2. **온보딩**: 튜토리얼 전투 → 기본 카드/에너지 시스템 학습.
3. **메타**: 메인 메뉴에서 캠페인 진행, 덱 편집, 일일 던전, 상점, PvP 진입 선택.
4. **성장 루프**:
   - 캠페인 최초 클리어 보상으로 골드/파편 수급 → 덱 강화.
   - 일일 던전 도전으로 희귀 재화 확보, Modifier 적응.
   - PvP를 통한 경쟁/보상(랭킹 시스템은 PvP 기획안에 상세 정의).
5. **재참여 동기**: 일일 던전 리셋, 상점 딜 갱신, 컷신/스토리 업데이트, 랭크 시즌 등.

## 7. 라이브 운영 포인트
- **필수 지표 트래킹**: 일일 실사용자(DAU), 캠페인 스테이지 진척, PvP 매칭 성공률/포기율, 일일 던전 완료율.
- **이벤트 운영**: 새로운 카드 패치 시 `cards.json` 버전 관리, Supabase 정책 업데이트, PowerShell 스크립트로 자산 동기화.
- **위험 요소**: Supabase 환경 변수 누락 시 경고 로그 발생, PvP 채널 구독 실패 시 에러 토스트 → 모니터링 필요.
- **CS 대응**: 클라우드 세이브 실패 로그(`[CloudSave]`)와 인증 에러 로그 기반 서버 이슈 진단.

## 8. 기술 구조
- **프론트엔드**: TypeScript, Vite, PixiJS(렌더링), Zustand(전역 상태), Vitest(테스트).
- **백엔드(PaaS)**: Supabase(Auth, Database, Realtime). RLS 정책으로 사용자 데이터 보호.
- **배포**: `npm run build:zip` → 정적 파일 패키징. Vercel 구성(`vercel.json`)으로 배포 설정 가능.
- **자산 관리**: `public/` 폴더에 카드/배경/아이콘 이미지, CLI 스크립트로 포맷 관리. 
- **환경 구성**: `.env.local`에 Supabase URL/Anon Key 필요, README에 Windows용 셋업 스크립트 안내.

## 9. 핵심 KPI 제안
- **Retention**: D1/D7 재방문율 (일일 던전·스토리 업데이트 영향 측정).
- **Engagement**: 평균 세션 길이, 캠페인 스테이지 클리어 수, PvP 평균 라운드 수.
- **Monetization 후보**: 상점 구매 전환율, 골드/파편 소비율(현재는 화폐 소진 루프 중심).
- **Stability**: Supabase 에러율, Cloud Save 성공률, PvP 매칭 평균 대기 시간.

## 10. 향후 로드맵 제안
- **콘텐츠 확장**: 캠페인 추가 챕터, 커스텀 일일 던전 Modifier, 스토리 컷신 음성 지원.
- **시스템 고도화**: 랭크 시즌제, PvP 리플레이 저장, 카드 밸런스 자동 리포트.
- **UX 개선**: 모바일 최적화 HUD, 접근성(색약 모드, 자막).
- **데이터/분석**: Supabase Functions + 웹 분석(Amplitude/GA) 연동으로 플레이어 여정 데이터 확보.
- **수익 모델**: 코스튬 카드 스킨/배경 패키지, 시즌 패스, PvP 티켓.
- **배포 인프라**: Vercel AI Cloud를 사용한 글로벌 CDN 배포 및 AI Gateway, Fluid Compute 기반 확장 계획 수립(기존 Vercel 템플릿/가이드 활용 예정).<https://vercel.com/>

---

### 부록: 관련 리소스 맵
- 코드 기반: `web/src/main.ts`, `web/src/store.ts`, `web/src/cloudSave.ts`, `web/src/authStore.ts`.
- 자산: `web/public/cards/*`, `web/public/backgrounds/*`, `web/public/cardIcons/*`, `web/public/characters/*`.
- 테스트/품질: `web/__tests__/*`, `web/scripts/*.js`, PowerShell 자산 파이프라인(`Scripts/PrepareWebAssets.ps1` 등).
- 운영문서: `기획서/이전문서/라이브운영_전략.md`, `PvP_규칙_및_랭크_시스템.md` 등과 연계.

> 본 문서는 현재 배포 중인 웹 카드 배틀 서비스의 핵심 기능과 운영 방향을 요약한 자료로, 기획/운영/개발 협업 시 공통 기준점으로 활용할 수 있습니다.


